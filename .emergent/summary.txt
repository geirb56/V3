<analysis>**original_problem_statement:**
The user wants to build CardioCoach, an AI-powered endurance coaching app using Strava data. The initial goal was a mobile-first decision assistant with AI-driven insights, a weekly digest, and conversational Q&A, supporting English and French.

A major pivot occurred: the user mandated a complete refactoring to **remove all cloud LLM dependencies** (OpenAI, Claude, Gemini). The new architecture must be a **100% local, backend-driven analysis engine** using predefined rules and text templates. This change is to ensure Strava API compliance and eliminate API costs.

**PRODUCT REQUIREMENTS (Post-Pivot):**
- **Core Engine:** A deterministic, template-based analysis engine running on the backend (). No external LLM calls for generating insights.
- **Compliance:** 100% compliant with Strava API rules (no raw user data sent to third parties).
- **Features:** The engine must generate analyses for individual workouts, weekly reviews (Bilan de la semaine), and dashboard insights.
- **UX:** Maintain a human, coach-like tone. The app must be FRENCH first (default to French).
- **Auto-Sync:** Strava data must be synchronized automatically on application startup.

**User's preferred language**: French. The user has explicitly stated the application should be FRENCH first. The next agent MUST respond in French and ensure the application defaults to French.

**what currently exists?**
- A full-stack application (React frontend, FastAPI backend, MongoDB).
- Strava integration fetches detailed workout data, including HR zones, cadence, and pace.
- Key features implemented before the pivot include a Recovery Score, enriched User Goal setting (distance, time), and a redesigned Bilan de la semaine page.
- **The migration to a local, LLM-free analysis engine was started but failed, leaving the backend in a broken, non-functional state.** A new file  was created but is likely empty.

**Last working item**:
-   **Last item agent was working:** A critical and major refactoring to replace all cloud LLM calls with a new, local, deterministic analysis engine in . This involved removing all  and  usage from  and rewriting the core logic of all analysis endpoints.
-   **Status:** **BLOCKED**
-   **Agent Testing Done:** N
-   **Which testing method agent to use?** backend testing agent. The first step is to fix the broken . After that, all refactored endpoints (, , ) must be tested with  to confirm they return valid, deterministic data without any external API calls.
-   **User Testing Done:** N

**All Pending/In progress Issue list**:
-   **Issue 1:** The application backend is broken due to a failed refactoring attempt to remove LLMs. (Priority: P0)
-   **Issue 2:** The frontend page  was causing a Maximum call stack size exceeded error. (Priority: P1)

**Issues Detail**:
-   **Issue 1:** Broken backend from failed LLM removal.
    -   **Attempted fixes:** The previous agent made multiple, unsuccessful attempts to edit  to remove LLM calls. This resulted in s and left the file in an inconsistent and non-functional state. The agent was stuck in a loop and could not resolve it.
    -   **Next debug checklist:**
        1.  **CRITICAL FIRST STEP:** Restore  to the last known good commit before the refactoring began (likely around commit ). Do not try to patch the current broken file.
        2.  Systematically re-implement the refactor:
            -   Build out the logic and text templates in .
            -   In , import the new engine.
            -   One by one, replace the logic in each endpoint (, , ) to use the local engine.
            -   Completely remove all , , and related prompt variables.
        3.  Check for syntax errors with  before restarting the server.
    -   **Why fix this issue and what will be achieved with the fix?** This is a CRITICAL BLOCKER. The entire application is down. Fixing it accomplishes the user's primary goal of an LLM-free, Strava-compliant app.
    -   **Status:** BLOCKED
    -   **Is recurring issue?** N
    -   **Should Test frontend/backend/both after fix?** backend
    -   **Blocked on other issue:** This is the primary blocker for all other work.
-   **Issue 2:** Frontend crash on  page.
    -   **Attempted fixes:** The agent tried to add a VMA estimation feature, which caused a stack overflow crash. The agent's attempt to revert the file was unsuccessful.
    -   **Next debug checklist:**
        1.  After the backend is fixed, check if the  page loads.
        2.  If it crashes, view  and restore it to its original, simple state before the VMA feature was attempted.
    -   **Why fix this issue and what will be achieved with the fix?** Ensures the entire application is stable and accessible.
    -   **Status:** NOT STARTED
    -   **Is recurring issue?** Y
    -   **Should Test frontend/backend/both after fix?** frontend
    -   **Blocked on other issue:** Issue 1.

**In progress Task List**:
-   **Task 1:** Complete the migration to a local, LLM-free analysis engine.
    -   **Where to resume:** Start by restoring  from a previous commit. Then, follow the debug checklist for Issue 1 to correctly implement the local engine.
    -   **What will be achieved with this?** A functional, Strava-compliant, and cost-free backend for generating coaching insights, per the user's explicit instructions.
    -   **Status:** IN PROGRESS
    -   **Should Test frontend/backend/both after fix?** backend
    -   **Blocked on something:** The broken state of .

**Upcoming and Future Tasks**
-   **Upcoming Tasks:**
    -   **P0:** Set default application language to French. Modify .
    -   **P0:** Implement automatic Strava data sync on application startup. This could be triggered from a  in .
    -   **P1:** Add a visual representation of heart rate zones to the workout detail view.
-   **Future Tasks:**
    -   **P2:** Re-attempt to display the VMA/VO2max estimation in the UI (e.g., in Settings), since the backend API () is already complete and functional.
    -   **P2:** Implement a page to view the history of past Bilan de la semaine (Weekly Reviews).
    -   **P3:** Prepare the architecture for a future, premium-only conversational coach feature using a local LLM like Ollama.

**Completed work in this session**
-   **Local VMA/VO2Max Estimation API:** Created a working backend endpoint () that estimates VMA/VO2max from user data with a reliability score.
-   **Enriched Strava Data Sync:** The Strava import was enhanced to include detailed data streams like heart rate zones, pace variability, and cadence.
-   **Enhanced Goal Setting:** The Training Goal feature was improved to include standard distances (Marathon, Semi, etc.) and a target time, with automatic target pace calculation.
-   **Dashboard Bug Fix:** Resolved a double render flickering issue by implementing a backend cache and a frontend  guard.

**Earlier issues found/mentioned but not fixed**
-   The frontend crash on the  page remains unresolved (see Issue 2).

**Known issue recurrence from previous fork**
-   None.

**Code Architecture**


**Key Technical Concepts**
-   **Architecture Pivot:** A fundamental shift from a cloud LLM-driven system to a local, deterministic, rule-based engine in Python for all coaching analyses.
-   **Backend:** FastAPI, MongoDB ().
-   **Frontend:** React, Tailwind CSS.

**key DB schema**
-   **workouts**: Enriched with  (dict),  (float),  (dict),  (int),  (int).
-   **user_goals**: 

**changes in tech stack**
-   **DEPRECATED:** All use of  and external LLM APIs (OpenAI, Claude, etc.).
-   **NEW:** A local, rule-based analysis engine to be built in .

**All files of reference**
-   : **CRITICAL, BROKEN.** The primary file that needs to be fixed and refactored.
-   : **NEW, INCOMPLETE.** Intended to house the new local analysis logic.
-   : **UNSTABLE.** Was causing crashes and needs to be verified/restored.
-   : Needs to be modified to set the default language to French.

**Areas that need refactoring**:
-   The core analysis logic in  must be entirely removed and replaced with calls to the new local engine, as per the user's main request.

**key api endpoints**
-   **Working:**
    -   
    -   
-   **BROKEN / TO BE REFACTORED:**
    -   
    -   
    -   
-   **TO BE REMOVED/DISABLED:**
    -    (Conversational Q&A endpoint is no longer part of the core, LLM-free product)

**Critical Info for New Agent**
-   **PRIORITY #1: FIX THE BROKEN BACKEND.** The application is completely non-functional. The first and only priority is to complete the refactoring to a local analysis engine.
-   **RECOVERY STRATEGY:** Do **not** try to patch the current broken . **Restore it** from a known good commit *before* the refactoring started, then re-implement the changes cleanly and systematically.
-   **NO MORE CLOUD LLMs:** This is a strict, non-negotiable user mandate. All coaching analysis must be generated locally.
-   **USER REQUESTS TO IMPLEMENT:** After the main fix, you must (1) make the app FRENCH first and (2) implement automatic Strava sync on startup.

**documents and test reports created in this job**
-    through 
-   

**Last 10 User Messages and any pending HUMAN messages**
A summary of the user's recent interactions shows increasing frustration as the agent got stuck in a loop while attempting the major refactoring. The user repeatedly asked if the agent was bugging or had stopped working, and confirmed the task was not finished. The key takeaways are:
1.  **High Priority Task:** The user wants the LLM-removal refactoring completed above all else.
2.  **Agent Failure:** The previous agent failed to execute this task and left the app in a broken state.
3.  **User Requests:** The user also made clear requests for FRENCH first and auto-sync on startup that were not implemented.
4.  **Compliance:** The user has mentioned Strava API rules multiple times, indicating this is a critical concern.

**Project Health Check:**
-   **Broken:** The backend is non-functional. The  frontend page is likely broken.
-   **Mocked:** None.

**3rd Party Integrations**
-   **Strava API:** Live and functional for data fetching.
-   **Emergent LLM Key / :** To be completely removed from the codebase.

**Testing status**
-   **Testing agent used after significant changes:** NO. The last major change failed before testing could occur.
-   **Troubleshoot agent used after agent stuck in loop:** NO.
-   **Test files created:** None in this session.
-   **Known regressions:** The entire analysis functionality is a regression as it's currently broken.

**Credentials to test flow:**
-   Strava API credentials are in .

**What agent forgot to execute**
-   The primary task of refactoring the backend to an LLM-free model.
-   The request to make the application FRENCH first.
-   The request to add automatic Strava sync on startup.
-   Fixing the crash on the  page.</analysis>
